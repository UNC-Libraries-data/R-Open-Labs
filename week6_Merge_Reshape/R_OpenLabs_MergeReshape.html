<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.649">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>beginR: Joining and Reshaping with tidyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="R_OpenLabs_MergeReshape_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_OpenLabs_MergeReshape_files/libs/quarto-html/quarto.js"></script>
<script src="R_OpenLabs_MergeReshape_files/libs/quarto-html/popper.min.js"></script>
<script src="R_OpenLabs_MergeReshape_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_OpenLabs_MergeReshape_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_OpenLabs_MergeReshape_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_OpenLabs_MergeReshape_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_OpenLabs_MergeReshape_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_OpenLabs_MergeReshape_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_OpenLabs_MergeReshape_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-and-other-downloads" id="toc-data-and-other-downloads" class="nav-link active" data-scroll-target="#data-and-other-downloads">Data and other downloads</a></li>
  <li><a href="#today" id="toc-today" class="nav-link" data-scroll-target="#today">Today</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#merging-joining-dataframes" id="toc-merging-joining-dataframes" class="nav-link" data-scroll-target="#merging-joining-dataframes">Merging / Joining Dataframes</a>
  <ul class="collapse">
  <li><a href="#appending" id="toc-appending" class="nav-link" data-scroll-target="#appending">Appending</a></li>
  <li><a href="#merging" id="toc-merging" class="nav-link" data-scroll-target="#merging">Merging</a></li>
  <li><a href="#types-of-joins" id="toc-types-of-joins" class="nav-link" data-scroll-target="#types-of-joins">Types of Joins</a></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions">Extensions</a></li>
  </ul></li>
  <li><a href="#reshaping-with-tidyr" id="toc-reshaping-with-tidyr" class="nav-link" data-scroll-target="#reshaping-with-tidyr">Reshaping with tidyr</a>
  <ul class="collapse">
  <li><a href="#pivot_longer" id="toc-pivot_longer" class="nav-link" data-scroll-target="#pivot_longer"><code>pivot_longer</code></a></li>
  <li><a href="#pivot_wider" id="toc-pivot_wider" class="nav-link" data-scroll-target="#pivot_wider"><code>pivot_wider</code></a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">beginR: Joining and Reshaping with tidyr</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="data-and-other-downloads" class="level3">
<h3 class="anchored" data-anchor-id="data-and-other-downloads">Data and other downloads</h3>
<p><a href="data/brazilian-ecommerce-subset.zip">Download data</a></p>
<p>Data derived from <a href="https://www.kaggle.com/olistbr/brazilian-ecommerce">Brazilian E-Commerce Public Dataset by Olist</a> provided on Kaggle.com under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 license</a>.</p>
</section>
<section id="today" class="level2">
<h2 class="anchored" data-anchor-id="today">Today</h2>
<p>This workshop covers topics from:</p>
<p><a href="http://r4ds.had.co.nz/tidy-data.html">Chapter 12</a></p>
<p><a href="http://r4ds.had.co.nz/relational-data.html">Chapter 13</a></p>
<ul>
<li>Joining / Merging datasets
<ul>
<li><code>bind_rows</code> and <code>bind_cols</code></li>
<li><code>inner_join</code></li>
<li>“Outer Joins” - <code>full_join</code>,<code>left_join</code>,<code>right_join</code></li>
</ul></li>
<li>Reshaping data
<ul>
<li><p><code>pivot_longer</code></p></li>
<li><p><code>pivot_wider</code></p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.7     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
</div>
</section>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>In most of our lessons so far, we’ve typically focused on a single dataset. This week, we’ll cover different methods for combining multiple datasets and transforming the shape of our data.</p>
<p>When using data that includes similar observational units collected by different sources, we will often find ourselves with multiple datasets that need to be combined before we can begin analysis. For example, if we wanted to gather various pieces of information for all of the countries in the world, we’d need to <strong>merge</strong> or <strong>join</strong> multiple datasets coming from the UN, the World Bank, the World Health Organization, etc. Or, we may simply need to add observations to an existing dataset (e.g.&nbsp;if we have multiple datasets coming from the World Bank, but each dataset only covers a single year.)</p>
<p>In other cases, we might need to reshape data we already have to make it more appropriate for other software, for analysis, or easier to use within R. If you’re planning to export data from R to another software package, you may need a particular format. For example, mapping software like ArcGIS needs each row of a dataset to represent a geographic location.</p>
</section>
<section id="merging-joining-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="merging-joining-dataframes">Merging / Joining Dataframes</h2>
<section id="appending" class="level3">
<h3 class="anchored" data-anchor-id="appending">Appending</h3>
<p>Sometimes we’ll have two datasets with similar columns that we need to combine. Essentially, we are stacking the rows of those datasets on top of each other. We can combine rows in <code>dplyr</code> with <code>bind_rows</code>:</p>
<p><strong>Dataset 1</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>a0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"StudentID"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"GPA_change"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StudentID GPA_change
1         1  -0.383746
2         2  -2.691883</code></pre>
</div>
</div>
<p><strong>Dataset 2</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>a1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"StudentID"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"GPA_change"</span><span class="ot">=</span><span class="fu">rnorm</span>(<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Semester"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Spring"</span>,<span class="st">"Fall"</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StudentID GPA_change Semester
1         3 -0.6686152   Spring
2         4 -0.4618874     Fall</code></pre>
</div>
</div>
<p><strong>Datasets combined</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(a0,a1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StudentID GPA_change Semester
1         1 -0.3837460     &lt;NA&gt;
2         2 -2.6918828     &lt;NA&gt;
3         3 -0.6686152   Spring
4         4 -0.4618874     Fall</code></pre>
</div>
</div>
<p>When we refer to <strong>merging</strong> or <strong>joining</strong>, we usually do not mean appending or adding observations to a dataset in this way. Instead, joining usuallly intends to add columns or variables to our dataframe. R does have a bind_cols function, but in the context below, using bind_cols is unhelpful and results in mismatched records.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"name"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Marcos"</span>,<span class="st">"Crystal"</span>),</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"year"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1993</span>,<span class="dv">1996</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"name"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Crystal"</span>,<span class="st">"Marcos"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"project_num"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(b0,b1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `name` -&gt; `name...1`
• `name` -&gt; `name...3`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  name...1 year name...3 project_num
1   Marcos 1993  Crystal           6
2  Crystal 1996   Marcos           3</code></pre>
</div>
</div>
<p>Instead, we want to add columns while making sure certain identifying variables, often called <strong>keys</strong> (e.g.&nbsp;<code>name</code> and <code>name1</code> above) line up correctly. That way, each row represents information about a single observational unit.</p>
</section>
<section id="merging" class="level3">
<h3 class="anchored" data-anchor-id="merging">Merging</h3>
<section id="keys" class="level4">
<h4 class="anchored" data-anchor-id="keys">Keys</h4>
<p>To properly line up observations between two datasets, we need a common variable (or group of variables) that uniquely identifies an observation in at least one of the datasets, and identifies it in the same way across both datasets. This variable is usually called a “key”. In our example above, <code>b0</code> and <code>b1</code> have the key “name”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year
1  Marcos 1993
2 Crystal 1996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name project_num
1 Crystal           6
2  Marcos           3</code></pre>
</div>
</div>
<p>Once we have matching key variable(s) in our datasets, we can join our datasets into consistent observations. There are two major categories of joins - “Inner Joins” and “Outer Joins”.</p>
</section>
</section>
<section id="types-of-joins" class="level3">
<h3 class="anchored" data-anchor-id="types-of-joins">Types of Joins</h3>
<p>We need several different types of joins to facillitate the different ways datasets are organized.</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Join Type</th>
<th>Want to keep</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Inner Join</strong></td>
<td>Only the rows in both datasets</td>
<td><code>inner_join()</code></td>
</tr>
<tr class="even">
<td><strong>Full (Outer) Join</strong></td>
<td>All of the rows</td>
<td><code>full_join()</code></td>
</tr>
<tr class="odd">
<td><strong>Left (Outer) Join</strong></td>
<td>All of the rows in the first (left) dataset, only the matches from the second (right) dataset</td>
<td><code>left_join()</code></td>
</tr>
<tr class="even">
<td><strong>Right (Outer) Join</strong></td>
<td>All of the rows in the second (left) dataset, only the matches from the first (right) dataset</td>
<td><code>right_join()</code></td>
</tr>
</tbody>
</table>
<p>The join types can be represented as Venn Diagrams. The lighter parts of the circles represent unmatched records we are leaving out of the join, while the darker parts represent both matched and unmached records we are keeping in the join.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="join-venn-dark.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Join Types from R for Data Science 13.4.3</figcaption><p></p>
</figure>
</div>
<p>Take a look at these two datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"name"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Marcos"</span>,<span class="st">"Crystal"</span>,<span class="st">"Devin"</span>,<span class="st">"Lilly"</span>),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"year"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1993</span>,<span class="dv">1996</span>,<span class="dv">1985</span>,<span class="dv">2001</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"person"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Marcos"</span>,<span class="st">"Crystal"</span>,<span class="st">"Devin"</span>,<span class="st">"Tamera"</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"project_num"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year
1  Marcos 1993
2 Crystal 1996
3   Devin 1985
4   Lilly 2001</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   person project_num
1  Marcos           6
2 Crystal           3
3   Devin           9
4  Tamera           8</code></pre>
</div>
</div>
<p>Now, let’s merge them using each of the different join types.</p>
<section id="inner-join" class="level4">
<h4 class="anchored" data-anchor-id="inner-join">Inner Join</h4>
<section id="inner_join" class="level5">
<h5 class="anchored" data-anchor-id="inner_join"><code>inner_join</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(b0,b1,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span><span class="ot">=</span><span class="st">"person"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year project_num
1  Marcos 1993           6
2 Crystal 1996           3
3   Devin 1985           9</code></pre>
</div>
</div>
</section>
</section>
<section id="outer-joins" class="level4">
<h4 class="anchored" data-anchor-id="outer-joins">Outer Joins</h4>
<section id="full_join" class="level5">
<h5 class="anchored" data-anchor-id="full_join"><code>full_join</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(b0,b1,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span><span class="ot">=</span><span class="st">"person"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year project_num
1  Marcos 1993           6
2 Crystal 1996           3
3   Devin 1985           9
4   Lilly 2001          NA
5  Tamera   NA           8</code></pre>
</div>
</div>
</section>
<section id="left_join" class="level5">
<h5 class="anchored" data-anchor-id="left_join"><code>left_join</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(b0,b1,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span><span class="ot">=</span><span class="st">"person"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year project_num
1  Marcos 1993           6
2 Crystal 1996           3
3   Devin 1985           9
4   Lilly 2001          NA</code></pre>
</div>
</div>
</section>
<section id="right_join" class="level5">
<h5 class="anchored" data-anchor-id="right_join"><code>right_join</code></h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(b0,b1,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span><span class="ot">=</span><span class="st">"person"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name year project_num
1  Marcos 1993           6
2 Crystal 1996           3
3   Devin 1985           9
4  Tamera   NA           8</code></pre>
</div>
</div>
<p><em>Note: All of these join functions come from the <code>dplyr</code> package, so we can use them with pipes ( %&gt;% )</em></p>
</section>
</section>
</section>
<section id="extensions" class="level3">
<h3 class="anchored" data-anchor-id="extensions">Extensions</h3>
<section id="multiple-keys" class="level4">
<h4 class="anchored" data-anchor-id="multiple-keys">Multiple Keys</h4>
<p>In some cases, we may need multiple keys to uniquely identify an observation. For example, our datasets below have two different observations for each person, so we need to join them by both name and year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>multi0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"name"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Tamera"</span>,<span class="st">"Zakir"</span>,<span class="st">"Zakir"</span>,<span class="st">"Tamera"</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"year"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">1990</span>,<span class="dv">1991</span>,<span class="dv">1991</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"state"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"NC"</span>,<span class="st">"VA"</span>,<span class="st">"VA"</span>,<span class="st">"NY"</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>multi1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"person"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Tamera"</span>,<span class="st">"Zakir"</span>,<span class="st">"Zakir"</span>,<span class="st">"Tamera"</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"year"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">1990</span>,<span class="dv">1990</span>,<span class="dv">1991</span>,<span class="dv">1991</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"project_num"</span><span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">8</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>multijoined <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(multi0,multi1,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by=</span><span class="fu">c</span>(<span class="st">"name"</span><span class="ot">=</span><span class="st">"person"</span>,<span class="st">"year"</span><span class="ot">=</span><span class="st">"year"</span>))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>multijoined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    name year state project_num
1 Tamera 1990    NC           6
2  Zakir 1990    VA           3
3  Zakir 1991    VA           9
4 Tamera 1991    NY           8</code></pre>
</div>
</div>
</section>
<section id="many-to-one-and-one-to-many-joins" class="level4">
<h4 class="anchored" data-anchor-id="many-to-one-and-one-to-many-joins">Many-to-one and One-to-many Joins</h4>
<p>If we only specify enough key variables to uniquely identify observations in one dataset and not the other, each unique value from the first dataset will be joined to each instance of that value in the other dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>statedata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">"state"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"NC"</span>,<span class="st">"VA"</span>,<span class="st">"NY"</span>),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"region"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Southeast"</span>,<span class="st">"Southeast"</span>,<span class="st">"Northeast"</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(statedata,multijoined,<span class="at">by=</span><span class="fu">c</span>(<span class="st">"state"</span><span class="ot">=</span><span class="st">"state"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state    region   name year project_num
1    NC Southeast Tamera 1990           6
2    VA Southeast  Zakir 1990           3
3    VA Southeast  Zakir 1991           9
4    NY Northeast Tamera 1991           8</code></pre>
</div>
</div>
<p><em>Note: We can equivalently omit <code>by=c("state"="state")</code> since the key variables have the same name here.</em></p>
</section>
</section>
</section>
<section id="reshaping-with-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-with-tidyr">Reshaping with tidyr</h2>
<p>Once we have a single dataset, we may still need to change its shape. When we talk about the <strong>shape</strong> of a dataset, we are often referring to whether it is wide or long.</p>
<ul>
<li><p><strong>Wide dataset</strong> - typically includes more columns and fewer rows with a single row for each observation</p></li>
<li><p><strong>Long dataset</strong> - typically includes fewer columns and more rows with multiple rows for each observation</p></li>
</ul>
<p>The many functions used in R for changing a datasets’ shape have varied over the years along with the terminology (e.g.&nbsp;“reshape”, “melt”, “cast”, “tidy”, “gather”, “spread”, “pivot”, etc.) We will now be working with the new reshaping functions recommended by <a href="https://tidyr.tidyverse.org/articles/pivot.html">tidyverse</a>, <code>pivot_longer()</code> and <code>pivot_wider()</code>.</p>
<p><em>Hadley Wickham’s <a href="http://vita.had.co.nz/papers/tidy-data.html">Tidy Data</a> provides more discussion of what “Tidy Data” entails and why it’s useful in data analysis.</em></p>
<section id="use-case-making-ggplot-easier" class="level4">
<h4 class="anchored" data-anchor-id="use-case-making-ggplot-easier">Use Case: Making <code>ggplot</code> easier</h4>
<p>Why reshape when we have perfectly good data? Sometimes R’s own functions are more convenient with reshaped data. Consider the dataset below in which we’ve generated random numbers for columns A and B.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>df0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span><span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">2001</span>,<span class="dv">2002</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">A=</span><span class="fu">runif</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">B=</span><span class="fu">runif</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">20</span>))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year         A        B
1 2000  5.751550 17.66035
2 2001 15.766103 18.80935
3 2002  8.179538  0.91113</code></pre>
</div>
</div>
<p>Now we want to create a line plot in which each column has its own line. Because our dataset is <strong>wide</strong>, we’ll need to add each line to the plot separately and individually.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df0,<span class="fu">aes</span>(<span class="at">x=</span>year)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>A),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>B),<span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_OpenLabs_MergeReshape_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, if we were using a <strong>long</strong> dataset, we could create the plot with less code. Note how our dataset below has a single column for categories A and B.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span><span class="fu">c</span>(df0<span class="sc">$</span>year,df0<span class="sc">$</span>year),</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">category=</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>,<span class="st">"B"</span>),</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value=</span><span class="fu">c</span>(df0<span class="sc">$</span>A,df0<span class="sc">$</span>B))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year category     value
1 2000        A  5.751550
2 2001        A 15.766103
3 2002        A  8.179538
4 2000        B 17.660348
5 2001        B 18.809346
6 2002        B  0.911130</code></pre>
</div>
</div>
<p>And for our plot, we only need to add a single <code>geom_line</code> while using the category column for our <code>color</code> aesthetic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df1,<span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>value,<span class="at">color=</span>category))<span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_OpenLabs_MergeReshape_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This may not seem like much of a big deal for this particular plot, but what if we were trying to plot hundreds of lines?</p>
<p>We can move back and forth between the long shape used by <code>df1</code> and the wide shape used by <code>df0</code> with tidyr’s <code>pivot_longer</code> and <code>pivot_wider</code> functions.</p>
</section>
<section id="pivot_longer" class="level3">
<h3 class="anchored" data-anchor-id="pivot_longer"><code>pivot_longer</code></h3>
<p>First, let’s create a small example dataset with four columns of randomly generated numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>raw <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">City=</span><span class="fu">c</span>(<span class="st">"Raleigh"</span>,<span class="st">"Durham"</span>,<span class="st">"Chapel Hill"</span>),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2000=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2001=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2002=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2003=</span><span class="fu">rnorm</span>(<span class="dv">3</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         City      x2000      x2001      x2002      x2003
1     Raleigh -0.5604756 0.07050839  0.4609162 -0.4456620
2      Durham -0.2301775 0.12928774 -1.2650612  1.2240818
3 Chapel Hill  1.5587083 1.71506499 -0.6868529  0.3598138</code></pre>
</div>
</div>
<p><em>x2000 through x2003 represent something measured in 2000 to 2003, since R data.frames cannot have labels that start with numbers.</em></p>
<p>In the dataset above, we have information stored in separate columns for each year, but it might be more useful to store the year number itself in its own column. We can use the <code>pivot_longer</code> function to do this.</p>
<p><code>pivot_longer</code> takes four main arguments:</p>
<ol type="1">
<li><p>data: this must be a <strong>data frame</strong>.</p></li>
<li><p>cols: a <strong>list of column names</strong> that we want to pivot into a single column.</p></li>
<li><p>names_to: the <strong>name</strong> of the new column that will contain the names of the columns we are pivoting.</p></li>
<li><p>values_to: the <strong>name</strong> of another new column that will contain values of the columns we are pivoting.</p></li>
</ol>
<p>We can also use various other arguments with pivot_longer that allow us to do a number of handy things. For example, the names_prefix argument lets us remove the “x” in front of our year names. Run ?pivot_longer in your console for a full list of arguments that can be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>longpivot <span class="ot">&lt;-</span> raw <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"x"</span>), </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Year"</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"x"</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(longpivot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   City        Year    Value
   &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt;
 1 Raleigh     2000  -0.560 
 2 Raleigh     2001   0.0705
 3 Raleigh     2002   0.461 
 4 Raleigh     2003  -0.446 
 5 Durham      2000  -0.230 
 6 Durham      2001   0.129 
 7 Durham      2002  -1.27  
 8 Durham      2003   1.22  
 9 Chapel Hill 2000   1.56  
10 Chapel Hill 2001   1.72  
11 Chapel Hill 2002  -0.687 
12 Chapel Hill 2003   0.360 </code></pre>
</div>
</div>
<p>It’s often useful to think about how transformations like pivot_longer change the effective observational unit of the dataset. This dataset started with city-level observations in which each row was represented by a unique city name. The transformed data frame longpivot now observes one city in a given year in each row, so we now have multiple rows for the same city.</p>
</section>
<section id="pivot_wider" class="level3">
<h3 class="anchored" data-anchor-id="pivot_wider"><code>pivot_wider</code></h3>
<p>We can reverse our previous transformation with <code>pivot_wider</code>. This time, we’ll create a separate column for each city.</p>
<p><code>pivot_wider</code> takes three essential arguments:</p>
<ol type="1">
<li><p>data</p></li>
<li><p>names_from: the <strong>column</strong> whose values we’ll use to create new column names.</p></li>
<li><p>values_from: another <strong>column</strong> whose values we’ll use to fill the new columns.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>widepivot <span class="ot">&lt;-</span> longpivot <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> City, <span class="at">values_from =</span> Value)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(widepivot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Year  Raleigh Durham `Chapel Hill`
  &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt;
1 2000  -0.560  -0.230         1.56 
2 2001   0.0705  0.129         1.72 
3 2002   0.461  -1.27         -0.687
4 2003  -0.446   1.22          0.360</code></pre>
</div>
</div>
<p>Why would we want each city to have its own column? Well, it might be a useful step to determine which cities are most closely correlated as part of an Exploratory Data Analysis process. For example, we can now easily use this dataset with ggally to create a plot matrix.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>widepivot <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"Chapel Hill"</span>,<span class="st">"Durham"</span>,<span class="st">"Raleigh"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R_OpenLabs_MergeReshape_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises:</h2>
<p>All of today’s exercises involve the datasets included in <a href="data/brazilian-ecommerce-subset.zip">brazilian-commerce-subset.zip</a>.</p>
<ol type="1">
<li><p>Read olist_public_dataset_v2.csv into R. Explore the dataset. If necessary, refer to the metadata provided <a href="https://www.kaggle.com/olistbr/brazilian-ecommerce">here</a>.</p></li>
<li><p>Read product_category_name_translation.csv into R. Merge this dataframe into olist_public_dataset_v2.csv using <code>product_category_name</code> as the key variable.</p>
<p>Let’s explore which products are most frequently purchased together:</p></li>
<li><p>Use <code>group_by</code> and <code>summarize</code> to find the total <code>order_items_qty</code> for each <code>product_category_name_english</code> in each <code>customer state</code>. <a href="https://unc-libraries-data.github.io/R-Open-Labs/week3_Transformations/R_OpenLabs_3_Transformations.html">Review</a></p></li>
<li><p>Use <code>pivot_wider</code> to create a new dataframe with a row for each <code>customer_state</code> and a column for each <code>product_category_name_english</code>. Name this dataframe <code>products</code>.</p></li>
<li><p>Run the two lines of code below (make sure your dataframe from step 4 is called <code>products</code>!)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>products <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(products) <span class="co">#remove grouping </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>products[<span class="fu">is.na</span>(products)] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co">#replace missing data with zeroes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Use <code>ggpairs</code> or other Exploratory Data Analysis techniques to look for relationships between purchases of <code>small_appliances</code>,<code>consoles_games</code>,<code>air_conditioning</code>, and <code>construction_tools_safety</code>. (Remember to run <code>library(GGally)</code> before using <code>ggpairs</code>).</p></li>
<li><p>Repeat problems 3-6 with <code>order_products_value</code> (i.e.&nbsp;the amount spent vs the quantity purchased). Do you see different patterns? Explore other product categories.</p></li>
<li><p>Use <code>pivot_longer</code> and then <code>pivot_wider</code> to convert your <code>products</code> dataframe to one where each row is a different <code>product_category_name_english</code> and each column represents a different <code>customer_state</code>.</p></li>
<li><p>Choose 5 states. Which of these states have the most similar patterns of spending (as measured by correlation)?</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>