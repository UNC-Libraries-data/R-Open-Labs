<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>beginR: Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R_OpenLabs_Strings_and_Factors_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/quarto.js"></script>
<script src="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/popper.min.js"></script>
<script src="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_OpenLabs_Strings_and_Factors_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_OpenLabs_Strings_and_Factors_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_OpenLabs_Strings_and_Factors_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_OpenLabs_Strings_and_Factors_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-and-other-downloads" id="toc-data-and-other-downloads" class="nav-link active" data-scroll-target="#data-and-other-downloads">Data and other downloads</a></li>
  <li><a href="#set-up-your-project" id="toc-set-up-your-project" class="nav-link" data-scroll-target="#set-up-your-project">Set up Your Project</a></li>
  <li><a href="#getting-started-with-strings" id="toc-getting-started-with-strings" class="nav-link" data-scroll-target="#getting-started-with-strings">Getting Started With Strings</a></li>
  <li><a href="#combining-and-subsetting-strings" id="toc-combining-and-subsetting-strings" class="nav-link" data-scroll-target="#combining-and-subsetting-strings">Combining and Subsetting Strings</a></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions">Regular Expressions</a></li>
  <li><a href="#creating-factors" id="toc-creating-factors" class="nav-link" data-scroll-target="#creating-factors">Creating Factors</a></li>
  <li><a href="#altering-factors" id="toc-altering-factors" class="nav-link" data-scroll-target="#altering-factors">Altering Factors</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">beginR: Introduction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="data-and-other-downloads" class="level2">
<h2 class="anchored" data-anchor-id="data-and-other-downloads">Data and other downloads</h2>
<p><a href="data/inspections10k.csv">New York Business Inspections</a></p>
<p>&nbsp;</p>
<p>##Today</p>
<p>This workshop aims to cover:</p>
<ul>
<li>Strings
<ul>
<li>Combining and Subsetting Strings</li>
<li>Regular Expressions</li>
</ul></li>
<li>Factors
<ul>
<li>Creating Factors</li>
<li>Altering Factors</li>
</ul></li>
<li><a href="http://r4ds.had.co.nz/strings.html">R for Data Science Chapters 14 and 15</a></li>
</ul>
<p>&nbsp;</p>
</section>
<section id="set-up-your-project" class="level2">
<h2 class="anchored" data-anchor-id="set-up-your-project">Set up Your Project</h2>
<p>Don’t forget to:</p>
<ol type="1">
<li>Create a new project in R</li>
<li>Create a data folder inside your project folder</li>
<li>Download the dataset (inspections10k.csv) to your data folder</li>
<li>Load the tidyverse</li>
</ol>
<p>&nbsp;</p>
</section>
<section id="getting-started-with-strings" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-strings">Getting Started With Strings</h2>
<p>&nbsp;</p>
<p>Let’s start by importing our csv to a data frame called “insp”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Import ------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>insp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/inspections10k.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>Now we’ll use the <code>names()</code> function to explore the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(insp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "RecordID"          "CertificateNumber" "BusinessName"     
 [4] "InspectionDate"    "InspectionResult"  "Industry"         
 [7] "Borough"           "BuildingNumber"    "Street"           
[10] "Street2"           "UnitType"          "Unit"             
[13] "Description"       "City"              "State"            
[16] "Zip"               "Longitude"         "Latitude"         </code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>We have a lot of text in this dataset, which we can confirm by using the <code>class()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(insp<span class="sc">$</span>BusinessName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>The <strong>character</strong> object in R contains strings, aka text data. This lesson will introduce you to manipulating strings in R.</p>
<p>&nbsp;</p>
</section>
<section id="combining-and-subsetting-strings" class="level2">
<h2 class="anchored" data-anchor-id="combining-and-subsetting-strings">Combining and Subsetting Strings</h2>
<p>First, you’ll notice that the street names and street numbers in this dataset are split into two different columns. If we want to combine them, we can use the <code>str_c</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(insp<span class="sc">$</span>BuildingNumber, insp<span class="sc">$</span>Street)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "79SARATOGA AVE"         "4250BOSTON RD"          "2904STILLWELL AVE"     
 [4] "56228TH AVE"            "600E 138TH ST"          "1569SAINT NICHOLAS AVE"
 [7] "17142LIBERTY AVE"       "2444WALTON AVE"         "540HEGEMAN AVE"        
[10] "1304KINGS HWY"         
 [ reached getOption("max.print") -- omitted 9990 entries ]</code></pre>
</div>
</div>
<p>Take a look at the results above. We have a problem! We need a space to separate the street number and name. Luckily, we can add a parameter to <code>str_c</code> that allows us to do that. Let’s also add the results to a new column in our data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>insp<span class="sc">$</span>StreetAddress <span class="ot">&lt;-</span> <span class="fu">str_c</span>(insp<span class="sc">$</span>BuildingNumber, insp<span class="sc">$</span>Street, <span class="at">sep=</span><span class="st">" "</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(insp<span class="sc">$</span>StreetAddress)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "79 SARATOGA AVE"         "4250 BOSTON RD"         
[3] "2904 STILLWELL AVE"      "5622 8TH AVE"           
[5] "600 E 138TH ST"          "1569 SAINT NICHOLAS AVE"</code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>We can also subset portions of strings. Suppose we have a string that reads “Hello World” and we want to subset the word “Hello”. We can use the <code>str_sub()</code> function, but we need to let it know the leftmost character and the rightmost character for the portion we want to subset.</p>
<p>In our “Hello World” string, H is our leftmost character. It also has the first position in the string. O is our rightmost character and it has the fifth position in the string. So, our <code>str_sub()</code> function looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(<span class="st">"Hello World"</span>, <span class="dv">1</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello"</code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>The Industry column in our dataset includes an industry classification for all of our businesses along with a 3-digit code. We need subset that code and put it in a seperate column. Notice, however, that the code is at the <strong>end</strong> of the string rather than the beginning.</p>
<p>Luckily, we can use a negative sign to indicate that we are counting backwards from the end of the string. However, we still need to put the parameters of the function in order from <strong>leftmost character to rightmost character</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>insp<span class="sc">$</span>IndustryCode <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(insp<span class="sc">$</span>Industry, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>&nbsp;</p>
<p>Now that we’ve created a seperate column for the 3-digit code, we can remove it from the original Industry column by subsetting out the industry name. Unfortunately, the industry name is variable in length. Since we don’t know where the rightmost character will be for every industry name, how can we use <code>str_sub()</code>?</p>
<p>We know that the part of the string we want to remove is six characters long: the three-digit code plus a dash and two spaces. So, we just need to know the total length of the string minus six characters. Thankfully, there is a function that counts the total number of characters in a string, <code>str_length()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>insp<span class="sc">$</span>Industry <span class="ot">&lt;-</span> <span class="fu">str_sub</span>(insp<span class="sc">$</span>Industry, <span class="dv">1</span>, <span class="fu">str_length</span>(insp<span class="sc">$</span>Industry)<span class="sc">-</span><span class="dv">6</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(insp<span class="sc">$</span>Industry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Cigarette Retail Dealer" "Scrap Metal Processor"  
[3] "Tobacco Prod'T Sales"    "Stoop Line Stand"       
[5] "Electronic Store"        "Wearing Apparel"        </code></pre>
</div>
</div>
</section>
<section id="regular-expressions" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions">Regular Expressions</h2>
<p>Often when we are working with text data, we will find that we have characters which follow a certain pattern. For example, a U.S. phone number commonly follows this pattern:</p>
<ul>
<li>three numbers</li>
<li>dash</li>
<li>three numbers</li>
<li>dash</li>
<li>four numbers</li>
</ul>
<p>Likewise, an email address follows this one:</p>
<ul>
<li>some number of characters</li>
<li>@</li>
<li>some number of characters</li>
<li>.com</li>
</ul>
<p>It is often useful for us to be able to detect these patterns when working with strings. Many programming languages use a form of notation for describing these patterns called <strong>regular expressions</strong>. Some of the commonly used regular expressions in R are below.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Regular Expression</th>
<th>Pattern</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>^</td>
<td>start of string</td>
</tr>
<tr class="even">
<td>$</td>
<td>end of string</td>
</tr>
<tr class="odd">
<td>.</td>
<td>match any character</td>
</tr>
<tr class="even">
<td>[a-z]</td>
<td>match any lowercase letter</td>
</tr>
<tr class="odd">
<td>[A-Z]</td>
<td>match any uppercase letter</td>
</tr>
<tr class="even">
<td>[0-9]</td>
<td>match any number</td>
</tr>
<tr class="odd">
<td>[abc]</td>
<td>match a, b OR c</td>
</tr>
<tr class="even">
<td>[^abc]</td>
<td>match anything EXCEPT a, b OR c</td>
</tr>
<tr class="odd">
<td>{x}</td>
<td>perform the match x number of times</td>
</tr>
</tbody>
</table>
<p>Additional patterns can be found on the <a href="https://rstudio.github.io/cheatsheets/strings.pdf#page=2">Regular Expressions Cheat Sheet</a>.</p>
<p>Let’s try using them with some of our data. New York has a lot of numbered streets, so we’ll use the <code>str_detect()</code> function with regular expressions to find street names that begin with a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(insp<span class="sc">$</span>Street, <span class="st">"^[0-9]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
[13] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
 [ reached getOption("max.print") -- omitted 9980 entries ]</code></pre>
</div>
</div>
<p>As you can see, <code>str_detect()</code> only supplies us with TRUE or FALSE depending on whether each string matches our regular expression. However, we can combine it with the <code>mean()</code> function to determine what proportion of our streets begin with a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">str_detect</span>(insp<span class="sc">$</span>Street, <span class="st">"^[0-9]"</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1992794</code></pre>
</div>
</div>
<p>About 20% of our street names start with a number!</p>
<p>To actually see the strings that match our regular expressions, we need to use the <code>str_subset()</code> function. Many of our business names end with “INC”. Let’s find them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_subset</span>(insp<span class="sc">$</span>BusinessName, <span class="st">"INC$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "CONEY ISLAND 7 &amp; 7 SUPERMARKET INC" "MII VAPE ENTERPRISE INC"           
 [3] "MODELLS SPORTING GOODS INC"         "AFRIDA ANAN KOTWAL INC"            
 [5] "EVERGREEN FARM MARKET INC"          "KIRINO ENTERPIRSES INC"            
 [7] "NILKANTH FOOD MART INC"             "GT 157 DELI GROCERY INC"           
 [9] "GO NEWYORK TOURS INC"               "COMPUTER SYSTEMS PROVIDER, INC"    
 [ reached getOption("max.print") -- omitted 1947 entries ]</code></pre>
</div>
</div>
<p>To subset the portion of a string that matches the regular expression, we can use <code>str_extract()</code>. Let’s create a new column in our dataset called “InspectionYear” that includes only the year of “InspectionDate”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>insp<span class="sc">$</span>InspectionYear <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(insp<span class="sc">$</span>InspectionDate, <span class="st">"^[0-9]{4}"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(insp<span class="sc">$</span>InspectionYear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2016" "2017" "2016" "2017" "2018" "2017"</code></pre>
</div>
</div>
<p>So far, we’ve only scratched the surface of regular expressions using some extremely simple examples. Regular expressions can become very complex. To see some regular expressions used in the real world, visit the <a href="http://regexlib.com/DisplayPatterns.aspx">Regular Expression Library</a>.</p>
</section>
<section id="creating-factors" class="level2">
<h2 class="anchored" data-anchor-id="creating-factors">Creating Factors</h2>
<p>Let’s filter our dataset to include only the following inspection results: Pass, Warning, Violation Issued or Fail. We can use the <code>|</code> symbol to represent “OR” in our filters, allowing for multiple conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>insp_sm <span class="ot">&lt;-</span> insp <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(InspectionResult <span class="sc">==</span> <span class="st">"Pass"</span> <span class="sc">|</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>          InspectionResult <span class="sc">==</span> <span class="st">"Warning"</span> <span class="sc">|</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          InspectionResult <span class="sc">==</span> <span class="st">"Violation Issued"</span> <span class="sc">|</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>          InspectionResult <span class="sc">==</span> <span class="st">"Fail"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we want to plot these results on a simple bar chart like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(insp_sm, <span class="fu">aes</span>(InspectionResult)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_OpenLabs_Strings_and_Factors_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Our bars appear in alphabetical order. It’s the same if we create a frequency table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(insp_sm<span class="sc">$</span>InspectionResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
            Fail             Pass Violation Issued          Warning 
             136             2171             1913              177 </code></pre>
</div>
</div>
<p>&nbsp;</p>
<p>What if we want to order our results from best to worst? To create ordered categories in R, we have to use <strong>factors</strong>. A factor is a seperate class of object from characters, so we need to use a function to create one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>insp_sm<span class="sc">$</span>InspectionResult <span class="ot">&lt;-</span> <span class="fu">factor</span>(insp_sm<span class="sc">$</span>InspectionResult, </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Pass"</span>, <span class="st">"Warning"</span>, <span class="st">"Violation Issued"</span>, <span class="st">"Fail"</span>))</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(insp_sm<span class="sc">$</span>InspectionResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
</div>
<p>Notice the order we put our levels in above. That order will now be reflected in the bar chart and frequency table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(insp_sm, <span class="fu">aes</span>(InspectionResult)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_OpenLabs_Strings_and_Factors_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(insp_sm<span class="sc">$</span>InspectionResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
            Pass          Warning Violation Issued             Fail 
            2171              177             1913              136 </code></pre>
</div>
</div>
</section>
<section id="altering-factors" class="level2">
<h2 class="anchored" data-anchor-id="altering-factors">Altering Factors</h2>
<p>At times, we may want to rename the levels in our Factors. For example, a “Violation Issued” result usually means that the business owner has to pay a fine. So, let’s change the level “Violation Issued” to “Fine” using the <code>fct_recode()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>insp_sm<span class="sc">$</span>InspectionResult <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(insp_sm<span class="sc">$</span>InspectionResult, <span class="st">"Fine"</span> <span class="ot">=</span> <span class="st">"Violation Issued"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(insp_sm<span class="sc">$</span>InspectionResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Pass Warning    Fine    Fail 
   2171     177    1913     136 </code></pre>
</div>
</div>
<p>We may also want to combine our levels in some cases. Let’s use <code>fct_collapse()</code> to create levels that simply indicate a “Good” or “Bad” result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>insp_sm<span class="sc">$</span>InspectionResult <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(insp_sm<span class="sc">$</span>InspectionResult, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Good"</span> <span class="ot">=</span> <span class="st">"Pass"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Bad"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Warning"</span>, <span class="st">"Fine"</span>, <span class="st">"Fail"</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(insp_sm<span class="sc">$</span>InspectionResult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Good  Bad 
2171 2226 </code></pre>
</div>
</div>
<p>&nbsp;</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<p>Concerning our original “insp” data set, use the functions we learned this week to answer the following questions:</p>
<ol type="1">
<li><p>Create a new column called “Address” that includes the street address, city, state and zip.</p></li>
<li><p>How many business names have the word “NY” in them? <em>HINT: The <code>sum()</code> function will work here.</em></p></li>
<li><p>Find all business names that end with INC, LLC, or CORP. <em>HINT: remember the symbol we use for “or”.</em></p></li>
<li><p>Notice that there are multiple types of Record IDs, such as ENFO, CMPL, UNIT, DCA, etc. Create a new data frame called “enfo” that includes ONLY records with ENFO IDs. <em>HINT: You will need to use both <code>filter()</code> and <code>str_detect()</code> to accomplish this.</em></p></li>
<li><p>In your enfo dataset, remove the “-ENFO” portion from each ID. Note that the IDs are variable in length.</p></li>
<li><p>R comes pre-loaded with a dataset called “diamonds”. Store a copy of the dataset in your Global Environment with the following code:</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>diamonds <span class="ot">&lt;-</span> diamonds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="7" type="1">
<li><p>What class of object are the “cut”, “color” and “clarity” columns?</p></li>
<li><p>What happens when you use the <code>min()</code> function on the the cut column? What happens when you use the <code>min()</code> function on the factor in your “insp_sm” dataset?</p></li>
<li><p>How can you create an ordered factor? Use the <code>?</code> function to read the documentation on factors.</p></li>
<li><p><a href="https://en.wikipedia.org/wiki/Diamond_clarity#Clarity_grading">Read about the GIA diamond clarity grading scale here</a>. Alter the factor levels in the diamonds dataset to reflect the category names in the GIA scale (Flawless, Internally Flawless, etc.)</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>