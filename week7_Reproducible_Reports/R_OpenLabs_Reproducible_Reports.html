<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="University of North Carolina at Chapel Hill">

<title>Reproducible Reports</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R_OpenLabs_Reproducible_Reports_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/quarto.js"></script>
<script src="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/popper.min.js"></script>
<script src="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_OpenLabs_Reproducible_Reports_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_OpenLabs_Reproducible_Reports_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_OpenLabs_Reproducible_Reports_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_OpenLabs_Reproducible_Reports_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-and-other-downloads" id="toc-data-and-other-downloads" class="nav-link active" data-scroll-target="#data-and-other-downloads">Data and other downloads</a></li>
  <li><a href="#today" id="toc-today" class="nav-link" data-scroll-target="#today">Today</a></li>
  <li><a href="#start-a-new-project-in-r" id="toc-start-a-new-project-in-r" class="nav-link" data-scroll-target="#start-a-new-project-in-r">Start a New Project in R</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#rmarkdown-structure" id="toc-rmarkdown-structure" class="nav-link" data-scroll-target="#rmarkdown-structure">RMarkdown Structure</a></li>
  <li><a href="#header" id="toc-header" class="nav-link" data-scroll-target="#header">Header</a></li>
  <li><a href="#code-chunks" id="toc-code-chunks" class="nav-link" data-scroll-target="#code-chunks">Code Chunks</a></li>
  <li><a href="#formatted-text" id="toc-formatted-text" class="nav-link" data-scroll-target="#formatted-text">Formatted Text</a></li>
  <li><a href="#visual-r-markdown" id="toc-visual-r-markdown" class="nav-link" data-scroll-target="#visual-r-markdown">Visual R Markdown</a></li>
  <li><a href="#generating-the-html-document" id="toc-generating-the-html-document" class="nav-link" data-scroll-target="#generating-the-html-document">Generating the HTML document</a></li>
  <li><a href="#data-import" id="toc-data-import" class="nav-link" data-scroll-target="#data-import">Data Import</a></li>
  <li><a href="#useful-functions-for-exploring-dataframes" id="toc-useful-functions-for-exploring-dataframes" class="nav-link" data-scroll-target="#useful-functions-for-exploring-dataframes">Useful functions for exploring dataframes</a></li>
  <li><a href="#tables-and-knitrkable" id="toc-tables-and-knitrkable" class="nav-link" data-scroll-target="#tables-and-knitrkable">Tables and <code>knitr::kable</code></a></li>
  <li><a href="#adding-a-new-variable" id="toc-adding-a-new-variable" class="nav-link" data-scroll-target="#adding-a-new-variable">Adding a new variable</a></li>
  <li><a href="#selecting-columns" id="toc-selecting-columns" class="nav-link" data-scroll-target="#selecting-columns">Selecting Columns</a></li>
  <li><a href="#renaming-columns" id="toc-renaming-columns" class="nav-link" data-scroll-target="#renaming-columns">Renaming Columns</a></li>
  <li><a href="#plotting" id="toc-plotting" class="nav-link" data-scroll-target="#plotting">Plotting</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  <li><a href="#review" id="toc-review" class="nav-link" data-scroll-target="#review">Review</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Reproducible Reports</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>University of North Carolina at Chapel Hill </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="data-and-other-downloads" class="level2">
<h2 class="anchored" data-anchor-id="data-and-other-downloads">Data and other downloads</h2>
<p><a href="data/clean_cheese.csv">US Cheese Consumption</a></p>
<p>Cleaned data courtesy of the <a href="https://github.com/rfordatascience/tidytuesday">Tidy Tuesday project</a></p>
</section>
<section id="today" class="level2">
<h2 class="anchored" data-anchor-id="today">Today</h2>
<p>This workshop aims to cover:</p>
<ul>
<li>Review of Previous Topics
<ul>
<li>Starting a New Project</li>
<li>Loading the tidyverse</li>
<li>Importing Data</li>
<li>Graphics using ggplot</li>
<li>Data transformations</li>
<li>Summarizing Data</li>
</ul></li>
<li>Data Transformations
<ul>
<li>Reproducible Reports using Quarto</li>
</ul></li>
<li><a href="https://r4ds.hadley.nz/quarto">Chapter 27</a>
<ul>
<li>Note: This version uses <code>|&gt;</code> pipes instead of <code>%&gt;%</code>. In most places they should be interchangeable.</li>
</ul></li>
</ul>
</section>
<section id="start-a-new-project-in-r" class="level2">
<h2 class="anchored" data-anchor-id="start-a-new-project-in-r">Start a New Project in R</h2>
<p>It is best practice to set up a new directory each time we start a new project in R. To do so, complete the following steps:</p>
<ol type="1">
<li>Go to <strong>File &gt; New Project &gt; New Directory &gt; New Project</strong>.</li>
<li>Type in a name for your directory and click <strong>Browse</strong>. Be sure to pick a place for your directory that you will be able to <strong>find later</strong>.</li>
<li>Go to <strong>Finder</strong> on Mac or <strong>File Explorer</strong> on PC and find the directory you just created.</li>
<li>Inside your project directory, create a new folder called <strong>data</strong>.</li>
<li>Download or copy the <strong>data file</strong> (clean_cheese.csv) into the data folder.</li>
</ol>
<p>&nbsp;</p>
</section>
<section id="motivation" class="level2">
<h2 class="anchored" data-anchor-id="motivation">Motivation</h2>
<p>R Markdown provides a straightforward way to create reports that combine code and the output from that code with text commentary. This allows for the creation of automated, reproducible reports. R Markdown can knit together your analysis results with text and output it directly into HTML, PDF, or Word documents. In fact, we have been using R Markdown to generate the webpage for all of our R Open Labs workshops!</p>
<p>&nbsp;</p>
</section>
<section id="rmarkdown-structure" class="level2">
<h2 class="anchored" data-anchor-id="rmarkdown-structure">RMarkdown Structure</h2>
<p>R Markdown has three components.</p>
<ol type="1">
<li>An (optional) header in a language called YAML. This allows you to specify the type of output file and configure other options.</li>
<li>R code chunks wrapped by <code>```</code></li>
<li>Text mixed with simple formatting markup.</li>
</ol>
<p>To create a new R Markdown document (.Rmd), select File -&gt; New File -&gt; R Markdown.</p>
<p>You will have the option to select the output: we’ll use the default HTML for this workshop. Give the document a title and enter your name as author: this will create the header for you at the top of your new .html page! RStudio will create a new R Markdown document filled with examples of code chunks and text.</p>
</section>
<section id="header" class="level2">
<h2 class="anchored" data-anchor-id="header">Header</h2>
<p><img src="figures/header.png" class="img-fluid"> At the top of the page is the optional Yet Another Markup Language (YAML) header. This header is a powerful way to edit the formatting of your report (e.g.&nbsp;figure dimensions, presence of a table of contents, identifying the location of a bibliography file).</p>
</section>
<section id="code-chunks" class="level2">
<h2 class="anchored" data-anchor-id="code-chunks">Code Chunks</h2>
<p><img src="figures/code%20chunk.png" class="img-fluid"> R code chunks are surrounded by <code>```</code>. Inside the curly braces, it specifies that this code chunk will use R code (other programming languages are supported), then it names this chunk “setup”. Names are optional.</p>
<p>After the name, you specify options on whether you want the code or its results to be displayed in the final document. For this chunk, the <code>include=FALSE</code> options tells R Markdown that we want this code to run, but we do not want it to be displayed in the final HTML document. The R code inside the chunk <code>knitr::opts_chunk$set(echo = TRUE)</code> tells R Markdown to display the R code along with the results of the code in the HTML output for <strong>all</strong> code chunks below.</p>
<p>Use CTRL+ALT+i (PC) or CMD+OPTION+i (Mac) to insert R code blocks.</p>
</section>
<section id="formatted-text" class="level2">
<h2 class="anchored" data-anchor-id="formatted-text">Formatted Text</h2>
<p><img src="figures/text.png" class="img-fluid"></p>
<p>This is plain text with simple formatting added. The <code>##</code> tells R Markdown that “R Markdown” is a section header. The <code>**</code> around “Knit” tells R Markdown to make that word <strong>bold</strong>.</p>
<p>The RStudio team has helpfully condensed these code chunk and text formatting options into a <a href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">cheatsheet</a>.</p>
<p>You can get pretty far with options in the R Markdown cheatsheet, but R Markdown is a very powerful, flexible language that we do not have time to fully cover. More detailed references are:</p>
<p><a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf" class="uri">https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf</a></p>
<p><a href="https://bookdown.org/yihui/rmarkdown" class="uri">https://bookdown.org/yihui/rmarkdown</a></p>
</section>
<section id="visual-r-markdown" class="level2">
<h2 class="anchored" data-anchor-id="visual-r-markdown">Visual R Markdown</h2>
<p>Newer versions of R Studio provide a visual editor for R markdown documents. This can be accessed by toggling between the “Source” and “Visual” options in the top left corner of your Rmd script editor pane. (Note: In some older versions of R Studio, this is available as a compass-shaped icon in the top <em>right</em> corner instead).</p>
<p>Once activated, this interface is similar to a word processing software like Microsoft Word - shortcuts for bolding, italics, etc. are usually the same and there are icons and drop down menus available for lists, bullets, links, and more.</p>
<p>You can still use CTRL+ALT+i (PC) or CMD+OPTION+i (Mac) to insert R code blocks, or use the Insert&gt;Code Chunk&gt;R menu in the visual editor.</p>
<p>Read more about the visual editor here:<br>
<a href="https://rstudio.github.io/visual-markdown-editing/" class="uri">https://rstudio.github.io/visual-markdown-editing/</a></p>
</section>
<section id="generating-the-html-document" class="level2">
<h2 class="anchored" data-anchor-id="generating-the-html-document">Generating the HTML document</h2>
<p>Click the <strong>Knit</strong> button, and R Studio will generate an HTML report based on your R Markdown document.</p>
<p>Let’s try creating an R Markdown document to explore the US cheese consumption data and review what we learned in weeks 1-3.</p>
</section>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>consumption <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/clean_cheese.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 48 Columns: 17
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (17): Year, Cheddar, American Other, Mozzarella, Italian other, Swiss, B...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="useful-functions-for-exploring-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="useful-functions-for-exploring-dataframes">Useful functions for exploring dataframes</h2>
<p>Include one of the following in your document. We’ve used <code>eval = FALSE</code> here to prevent this code chunk from running!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(consumption)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(consumption)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(consumption)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tables-and-knitrkable" class="level2">
<h2 class="anchored" data-anchor-id="tables-and-knitrkable">Tables and <code>knitr::kable</code></h2>
<p>By default, R Markdown will display tables the way they appear in the R console. We can use <code>knitr::kable function</code> to get cleaner tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(consumption), <span class="at">caption =</span> <span class="st">"The first six rows of the cheese consumption data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>The first six rows of the cheese consumption data</caption>
<colgroup>
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 2%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Cheddar</th>
<th style="text-align: right;">American Other</th>
<th style="text-align: right;">Mozzarella</th>
<th style="text-align: right;">Italian other</th>
<th style="text-align: right;">Swiss</th>
<th style="text-align: right;">Brick</th>
<th style="text-align: right;">Muenster</th>
<th style="text-align: right;">Cream and Neufchatel</th>
<th style="text-align: right;">Blue</th>
<th style="text-align: right;">Other Dairy Cheese</th>
<th style="text-align: right;">Processed Cheese</th>
<th style="text-align: right;">Foods and spreads</th>
<th style="text-align: right;">Total American Chese</th>
<th style="text-align: right;">Total Italian Cheese</th>
<th style="text-align: right;">Total Natural Cheese</th>
<th style="text-align: right;">Total Processed Cheese Products</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1970</td>
<td style="text-align: right;">5.79</td>
<td style="text-align: right;">1.20</td>
<td style="text-align: right;">1.19</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">3.32</td>
<td style="text-align: right;">2.20</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">2.05</td>
<td style="text-align: right;">11.37</td>
<td style="text-align: right;">5.53</td>
</tr>
<tr class="even">
<td style="text-align: right;">1971</td>
<td style="text-align: right;">5.91</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">1.38</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.62</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">3.55</td>
<td style="text-align: right;">2.31</td>
<td style="text-align: right;">7.32</td>
<td style="text-align: right;">2.29</td>
<td style="text-align: right;">12.03</td>
<td style="text-align: right;">5.86</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1972</td>
<td style="text-align: right;">6.01</td>
<td style="text-align: right;">1.67</td>
<td style="text-align: right;">1.57</td>
<td style="text-align: right;">1.02</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">3.51</td>
<td style="text-align: right;">2.62</td>
<td style="text-align: right;">7.68</td>
<td style="text-align: right;">2.59</td>
<td style="text-align: right;">13.01</td>
<td style="text-align: right;">6.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">1973</td>
<td style="text-align: right;">6.07</td>
<td style="text-align: right;">1.76</td>
<td style="text-align: right;">1.76</td>
<td style="text-align: right;">1.03</td>
<td style="text-align: right;">1.06</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">3.31</td>
<td style="text-align: right;">2.68</td>
<td style="text-align: right;">7.83</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">13.49</td>
<td style="text-align: right;">5.99</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1974</td>
<td style="text-align: right;">6.31</td>
<td style="text-align: right;">2.16</td>
<td style="text-align: right;">1.86</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">1.18</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.70</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">3.42</td>
<td style="text-align: right;">2.92</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">14.41</td>
<td style="text-align: right;">6.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">1975</td>
<td style="text-align: right;">6.04</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">2.11</td>
<td style="text-align: right;">1.12</td>
<td style="text-align: right;">1.09</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.74</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">3.35</td>
<td style="text-align: right;">3.35</td>
<td style="text-align: right;">8.15</td>
<td style="text-align: right;">3.23</td>
<td style="text-align: right;">14.27</td>
<td style="text-align: right;">6.69</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="adding-a-new-variable" class="level2">
<h2 class="anchored" data-anchor-id="adding-a-new-variable">Adding a new variable</h2>
<p>We’ve covered two ways to add a new variable to a dataframe.</p>
<p><strong>Note:</strong> R allows non-standard variable names that include spaces, parentheses, and other special characters. The way to refer to variable names that contain wonky symbols is to use the backtick symbol <code>`</code>, found at the top left of your keyboard with the tilde <code>~</code>.</p>
<p>The base R way covered in lesson 1 using the <code>$</code> operator and <code>with()</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Base R way, covered in lesson 1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>consumption<span class="sc">$</span>amer_ital_ratio <span class="ot">&lt;-</span> <span class="fu">with</span>(consumption, <span class="st">`</span><span class="at">Total American Cheese</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Italian Cheese</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(substitute(expr), data, enclos = parent.frame()): object 'Total American Cheese' not found</code></pre>
</div>
</div>
<p>Oops. Better check the variable names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>consumption<span class="sc">$</span>amer_ital_ratio1 <span class="ot">&lt;-</span> <span class="fu">with</span>(consumption, <span class="st">`</span><span class="at">Total American Chese</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Italian Cheese</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The tidyverse way covered in lesson 3 using the <code>mutate()</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tidyverse way, covered in lesson 3</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>consumption <span class="ot">&lt;-</span> <span class="fu">mutate</span>(consumption, <span class="at">amer_ital_ratio2 =</span> <span class="st">`</span><span class="at">Total American Chese</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Italian Cheese</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="selecting-columns" class="level2">
<h2 class="anchored" data-anchor-id="selecting-columns">Selecting Columns</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>consumption <span class="ot">&lt;-</span> <span class="fu">select</span>(consumption, Year, Cheddar, Mozzarella, <span class="st">`</span><span class="at">Cream and Neufchatel</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="renaming-columns" class="level2">
<h2 class="anchored" data-anchor-id="renaming-columns">Renaming Columns</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>consumption <span class="ot">&lt;-</span> <span class="fu">rename</span>(consumption, <span class="at">Cream_and_Neufchatel =</span> <span class="st">`</span><span class="at">Cream and Neufchatel</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting" class="level2">
<h2 class="anchored" data-anchor-id="plotting">Plotting</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(consumption, <span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cheddar, <span class="at">col =</span> <span class="st">"Cheddar"</span>)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Mozzarella, <span class="at">col =</span> <span class="st">"Mozzarella"</span>)) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cream_and_Neufchatel, <span class="at">col =</span> <span class="st">"Cream and Neufchatel"</span>)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Consumption in Pounds Per Person"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_OpenLabs_Reproducible_Reports_files/figure-html/plot1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hmm. I don’t love that legend title. <a href="https://www.google.com/search?q=ggplot+legend+title&amp;oq=ggplot+legend+title">Time for google!</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(consumption, <span class="fu">aes</span>(<span class="at">x =</span> Year)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cheddar, <span class="at">col =</span> <span class="st">"Cheddar"</span>)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Mozzarella, <span class="at">col =</span> <span class="st">"Mozzarella"</span>)) <span class="sc">+</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Cream_and_Neufchatel, <span class="at">col =</span> <span class="st">"Cream and Neufchatel"</span>)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Consumption in Pounds Per Person"</span>) <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">col=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Cheese Type"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_OpenLabs_Reproducible_Reports_files/figure-html/plot2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
<p>R Markdown also provides a nifty way to incorporate a bibliography and references. We’ll haven an example of this in the exercises, but here’s a brief summary of the steps required to use a BibTex bibliography.</p>
<ol type="1">
<li>Create a plain-text .bib file in the same directory as your .Rmd R Markdown document.</li>
<li>Fill that .bib file with BibTex citations. The <a href="http://www.citationmachine.net/bibtex/cite-a-book">Citation Machine</a> can generate the BibTex citations for you.</li>
<li>Make sure each citation has a unique citation-key, the first entry</li>
<li>Add a bibliography field to the YAML header that tells R Markdown the name of your bibliography file, for example <code>bibliography: references.bib</code></li>
<li>Add citations throughout the document using square brackets.</li>
</ol>
</section>
<section id="review" class="level2">
<h2 class="anchored" data-anchor-id="review">Review</h2>
<p>We have now covered R Studio projects and R Markdown. With these two tools, you have everything you need to create portable and reproducible reports. We’ve also introduced tidyverse tools for data import (readr), graphics (ggplot2), and data transformation (dplyr). These are foundational tools that you will need in every data analysis project.</p>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises:</h2>
<ol type="1">
<li><p><a href="https://github.com/UNC-Libraries-data/R-Open-Labs/raw/master/week7_Reproducible_Reports/download/cheese.zip">Download the cheese RStudio Project</a> file and extract the R Project contained within. Then, knit the cheeseConsumption.Rmd report. It should generate an HTML report for you.</p></li>
<li><p>In the cheeseConsumption.Rmd file, find the code chunk named <strong>setup</strong>. change <code>echo=FALSE</code> to <code>echo=TRUE</code>. Try knitting the document again. What changed? Did this affect the whole document?</p></li>
<li><p>In the cheeseConsumption.Rmd file, find the code chunk named <strong>import</strong>. change <code>message=FALSE</code> to <code>message=TRUE</code>. Try knitting the document again. What changed? Did this affect the whole document?</p></li>
<li><p>Create another R Markdown document analyzing cheese production data contained in the state_milk_productions.csv file. You can use the data dictionary found <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-01-29">here</a> to make sense of the different variables. <strong>Hint</strong>: you’ll need to use the group-by %&gt;% summarize idiom <a href="https://unc-libraries-data.github.io/R-Open-Labs/week3_Transformations/R_OpenLabs_3_Transformations.html#piping">we learned in Week 3</a> to sum up all the state level data within each year. You’ll probably want to feed the output from that group-by %&gt;% summarize step into knitr::kable() to get a prettier table for your report.</p></li>
<li><p>Once you have created an R Markdown report analyzing cheese production, send the entire R Project to a friend (or us!) and ask them to knit that .Rmd document. If they have RStudio and the tidyverse installed, they should be able to seamlessly generate the exact report you generated, without having to make any changes.</p></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>